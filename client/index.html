<!DOCTYPE html>
<html lang="en" xmlns:x-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Leffler 6502</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="./programs.js"></script>
    <script src="./index.js"></script>
    <link rel="stylesheet" href="./style.css">
</head>
<body x-data="emulator()" @keydown.window="handleKeydown($event)">
<div class="panel">
    <label for="program-list">Load Program</label>
    <select id="program-list" x-model="loadedProgramName" @change="loadProgram()">
        <option value="">Select a program</option>
        <template x-for="program in programs" :key="program.name">
            <option :value="program.name" x-text="program.name"></option>
        </template>
    </select>
    <p x-text="getProgramDescription()">
    </p>

    <h1>CPU State</h1>
    <div>
        <p>A: <span x-text="hex(cpu.a)"></span></p>
        <p>X: <span x-text="hex(cpu.x)"></span></p>
        <p>Y: <span x-text="hex(cpu.y)"></span></p>
        <p>SP: <span x-text="hex(cpu.sp, 4)"></span></p>
        <p>PC: <span x-text="hex(cpu.pc, 4)"></span></p>

        <h3>Status</h3>
        <div class="flags">
            <span class="flag" :class="isFlagSet(FLAG_N) ? 'set' : 'clear'">N</span>
            <span class="flag" :class="isFlagSet(FLAG_V) ? 'set' : 'clear'">V</span>
            <span class="flag" :class="isFlagSet(FLAG_U) ? 'set' : 'clear'">U</span>
            <span class="flag" :class="isFlagSet(FLAG_B) ? 'set' : 'clear'">B</span>
            <span class="flag" :class="isFlagSet(FLAG_D) ? 'set' : 'clear'">D</span>
            <span class="flag" :class="isFlagSet(FLAG_I) ? 'set' : 'clear'">I</span>
            <span class="flag" :class="isFlagSet(FLAG_Z) ? 'set' : 'clear'">Z</span>
            <span class="flag" :class="isFlagSet(FLAG_C) ? 'set' : 'clear'">C</span>
        </div>

        <p>

           <button class="retro-btn" x-on:click="step()">Step</button>
           <button class="retro-btn" x-on:click="reset()"> RESET</button>
           <button class="retro-btn" x-on:click="nmi()"> NMI</button>
           <button class="retro-btn" x-on:click="irq()"> IRQ</button>
    </div>
    <h2>Disassembly</h2>
    <div class="disassembly-container">
        <template x-for="line in disassembly" :key="line.address">
            <div class="disassembly-line"
                 :class="{ 'current': isCurrentLine(line.address) }"
                 x-text="line.line">

            </div>
        </template>
    </div>
</div>

<div class="panel">
    <h2>Memory Page <span x-text="hex(memoryPage)"></span></h2>
    <button x-on:click="loadPage(memoryPage - 1)"><-</button>
    <button x-on:click="loadPage(memoryPage + 1)"> -></button>
    <table>
        <tbody>
        <template x-for="row in 16" :key="row">
            <tr>
                <td><strong><span x-text="hex(memoryPage * 0x100 + (row - 1) * 0x10, 4)"></span></strong></td>
                <template x-for="col in 16" :key="col">
                    <td
                            x-text="hex(pageData[(row-1)*16 + (col-1)] ?? 0)"
                            :data-nonzero="(pageData[(row-1)*16 + (col-1)] ?? 0) !== 0"
                    ></td>
                </template>
            </tr>
        </template>
        </tbody>
    </table>

    <h2>Stack</h2>
    <table>
        <tbody>
        <template x-for="row in 16" :key="row">
            <tr>
                <td><strong><span x-text="hex(stackPage * 0x100 + (row - 1) * 0x10, 4)"></span></strong></td>
                <template x-for="col in 16" :key="col">
                    <td
                            x-text="hex(stackData[(row-1)*16 + (col-1)] ?? 0)"
                            :data-nonzero="(stackData[(row-1)*16 + (col-1)] ?? 0) !== 0"
                            :class="{ 'sp-highlight': isSpPosition((row-1)*16 + (col-1)) }"
                    ></td>
                </template>
            </tr>
        </template>
        </tbody>
    </table>
</div>

</body>
</html>